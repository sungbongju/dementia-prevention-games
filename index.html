<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‘ë‡Œ ê±´ê°• ì „í†µë†€ì´</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700;900&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --hanji-cream: #F5F0E6;
            --dancheong-red: #C73E3A;
            --dancheong-blue: #1B4965;
            --dancheong-green: #2D5016;
            --dancheong-yellow: #E8B931;
            --wood-brown: #8B4513;
            --ink-black: #1A1A1A;
            --gold-accent: #D4AF37;
            --soft-shadow: rgba(139, 69, 19, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: var(--hanji-cream);
            min-height: 100vh;
            background-image: 
                url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M30 0L30 60M0 30L60 30' stroke='%23D4C5A9' stroke-width='0.5' fill='none' opacity='0.3'/%3E%3C/svg%3E");
        }

        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            padding-bottom: 120px; /* PIP ìœ„ì ¯ ê³µê°„ í™•ë³´ */
        }

        /* í—¤ë” */
        .header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, var(--dancheong-red) 0%, #A63030 100%);
            border-radius: 20px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 40px var(--soft-shadow);
        }

        .header::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            border: 3px solid var(--gold-accent);
            border-radius: 15px;
            opacity: 0.5;
        }

        .header::after {
            content: 'ç¦';
            position: absolute;
            right: 30px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 120px;
            color: rgba(255,255,255,0.1);
            font-family: 'Noto Serif KR', serif;
        }

        .header h1 {
            font-family: 'Noto Serif KR', serif;
            font-size: 3rem;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            position: relative;
            z-index: 1;
        }

        .header p {
            color: rgba(255,255,255,0.9);
            font-size: 1.2rem;
            margin-top: 10px;
            position: relative;
            z-index: 1;
        }

        /* í”Œë ˆì´ì–´ ì •ë³´ */
        .player-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px var(--soft-shadow);
            border: 2px solid var(--gold-accent);
        }

        .player-form {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }

        .player-form label {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--ink-black);
        }

        .player-input {
            font-size: 1.3rem;
            padding: 12px 20px;
            border: 3px solid var(--dancheong-blue);
            border-radius: 10px;
            width: 200px;
            font-family: 'Noto Sans KR', sans-serif;
        }

        .player-input:focus {
            outline: none;
            border-color: var(--dancheong-red);
        }

        .player-btn {
            background: var(--dancheong-blue);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Noto Sans KR', sans-serif;
        }

        .player-btn:hover {
            background: #0D2A3A;
        }

        .player-btn.secondary {
            background: var(--dancheong-green);
        }

        .player-btn.secondary:hover {
            background: #1A3009;
        }

        .player-info {
            display: none;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .player-info.active {
            display: flex;
        }

        .player-name-display {
            font-family: 'Noto Serif KR', serif;
            font-size: 1.8rem;
            color: var(--dancheong-red);
            font-weight: 900;
        }

        .session-badge {
            background: var(--dancheong-yellow);
            color: var(--ink-black);
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 700;
        }

        /* ì ìˆ˜íŒ */
        .scoreboard {
            background: linear-gradient(145deg, #2C1810 0%, #1A0F0A 100%);
            border-radius: 15px;
            padding: 25px 40px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            box-shadow: 
                0 8px 30px rgba(0,0,0,0.3),
                inset 0 1px 0 rgba(255,255,255,0.1);
            border: 2px solid var(--gold-accent);
        }

        .score-item {
            text-align: center;
        }

        .score-label {
            color: var(--gold-accent);
            font-size: 0.9rem;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .score-value {
            font-family: 'Noto Serif KR', serif;
            font-size: 2.5rem;
            color: white;
            font-weight: 900;
        }

        .total-score {
            background: var(--dancheong-red);
            padding: 15px 30px;
            border-radius: 10px;
            border: 2px solid var(--gold-accent);
        }

        .total-score .score-value {
            color: var(--gold-accent);
            font-size: 3rem;
        }

        /* ê²Œì„ ê·¸ë¦¬ë“œ */
        .game-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        /* ê²Œì„ ì¹´ë“œ */
        .game-card {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 8px 30px var(--soft-shadow);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 50px var(--soft-shadow);
        }

        .game-card.completed {
            opacity: 0.85;
        }

        .game-card.completed::after {
            content: 'âœ“ ì™„ë£Œ';
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--dancheong-green);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 700;
            z-index: 10;
        }

        .game-card.disabled {
            pointer-events: none;
            filter: grayscale(50%);
        }

        .game-icon {
            height: 140px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            position: relative;
            overflow: hidden;
        }

        .game-icon.hwatu { background: linear-gradient(135deg, #1B4965 0%, #0D2A3A 100%); }
        .game-icon.yut { background: linear-gradient(135deg, var(--dancheong-green) 0%, #1A3009 100%); }
        .game-icon.memory { background: linear-gradient(135deg, var(--dancheong-yellow) 0%, #C99B20 100%); }
        .game-icon.proverb { background: linear-gradient(135deg, var(--dancheong-red) 0%, #8B2525 100%); }
        .game-icon.calc { background: linear-gradient(135deg, #6B4423 0%, #3D2614 100%); }
        .game-icon.sequence { background: linear-gradient(135deg, #4A1942 0%, #2A0F27 100%); }

        .game-icon::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);
            top: -50%;
            left: -50%;
        }

        .game-info {
            padding: 25px;
        }

        .game-title {
            font-family: 'Noto Serif KR', serif;
            font-size: 1.5rem;
            color: var(--ink-black);
            margin-bottom: 10px;
        }

        .game-desc {
            color: #666;
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .game-score {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .points-badge {
            background: var(--hanji-cream);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            color: var(--wood-brown);
            font-weight: 500;
        }

        .play-btn {
            background: var(--dancheong-red);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Noto Sans KR', sans-serif;
        }

        .play-btn:hover {
            background: #A63030;
            transform: scale(1.05);
        }

        .play-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* ë²„íŠ¼ ê·¸ë£¹ */
        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .action-btn {
            background: var(--dancheong-blue);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 30px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Noto Sans KR', sans-serif;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .action-btn.save {
            background: var(--dancheong-green);
        }

        .action-btn.ranking {
            background: var(--dancheong-yellow);
            color: var(--ink-black);
        }

        .action-btn.reset {
            background: var(--dancheong-red);
        }

        .action-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* ê²Œì„ ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--hanji-cream);
            border-radius: 25px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .modal-header {
            background: var(--dancheong-red);
            padding: 25px 30px;
            border-radius: 25px 25px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header.blue { background: var(--dancheong-blue); }
        .modal-header.green { background: var(--dancheong-green); }

        .modal-title {
            font-family: 'Noto Serif KR', serif;
            font-size: 1.8rem;
            color: white;
        }

        .close-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .modal-body {
            padding: 30px;
        }

        /* ë­í‚¹ í…Œì´ë¸” */
        .ranking-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .ranking-table th,
        .ranking-table td {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid #ddd;
        }

        .ranking-table th {
            background: var(--dancheong-blue);
            color: white;
            font-weight: 700;
        }

        .ranking-table tr:hover {
            background: rgba(212, 175, 55, 0.1);
        }

        .rank-1 { color: var(--gold-accent); font-weight: 900; font-size: 1.2rem; }
        .rank-2 { color: #C0C0C0; font-weight: 700; }
        .rank-3 { color: #CD7F32; font-weight: 700; }

        /* ê¸°ë¡ ì¹´ë“œ */
        .record-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid var(--dancheong-blue);
        }

        .record-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .record-session {
            font-family: 'Noto Serif KR', serif;
            font-size: 1.3rem;
            color: var(--dancheong-blue);
        }

        .record-date {
            color: #888;
            font-size: 0.9rem;
        }

        .record-scores {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .record-score-item {
            text-align: center;
            padding: 10px;
            background: var(--hanji-cream);
            border-radius: 8px;
        }

        .record-score-item .label {
            font-size: 0.8rem;
            color: #666;
        }

        .record-score-item .value {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--ink-black);
        }

        .record-total {
            text-align: center;
            margin-top: 15px;
            padding: 10px;
            background: var(--dancheong-red);
            border-radius: 10px;
            color: white;
            font-size: 1.3rem;
            font-weight: 700;
        }

        /* íƒ­ */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-btn {
            flex: 1;
            padding: 15px;
            border: none;
            background: #ddd;
            border-radius: 10px 10px 0 0;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Noto Sans KR', sans-serif;
        }

        .tab-btn.active {
            background: var(--dancheong-blue);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ê²Œì„ë³„ ìŠ¤íƒ€ì¼ */
        
        /* í™”íˆ¬ ì§ë§ì¶”ê¸° */
        .hwatu-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            max-width: 500px;
            margin: 0 auto;
        }

        .hwatu-card {
            aspect-ratio: 2/3;
            background: linear-gradient(135deg, var(--dancheong-blue) 0%, #0D2A3A 100%);
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            transition: all 0.3s ease;
            border: 3px solid var(--gold-accent);
            position: relative;
            overflow: hidden;
        }

        .hwatu-card::before {
            content: 'èŠ±';
            font-family: 'Noto Serif KR', serif;
            color: rgba(255,255,255,0.2);
            font-size: 3rem;
        }

        .hwatu-card.flipped {
            background: white;
            border-color: var(--dancheong-red);
        }

        .hwatu-card.flipped::before {
            content: none;
        }

        .hwatu-card.matched {
            background: #E8F5E9;
            border-color: var(--dancheong-green);
            cursor: default;
        }

        /* ìƒ‰ìƒ íŒ¨í„´ ê¸°ì–µ (Simon) */
        .simon-container {
            text-align: center;
            padding: 20px;
        }

        .simon-message {
            font-family: 'Noto Serif KR', serif;
            font-size: 1.5rem;
            color: var(--ink-black);
            margin-bottom: 20px;
            min-height: 40px;
            font-weight: 500;
        }

        .simon-board {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            max-width: 320px;
            margin: 0 auto 30px;
        }

        .simon-btn {
            width: 140px;
            height: 140px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.15s ease;
            border: 4px solid rgba(0,0,0,0.2);
            box-shadow: 0 6px 0 rgba(0,0,0,0.2), 0 8px 15px rgba(0,0,0,0.1);
        }

        .simon-btn:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0 rgba(0,0,0,0.2);
        }

        #simon-red {
            background: linear-gradient(145deg, #ff6b6b, #c0392b);
        }
        #simon-red.active {
            background: linear-gradient(145deg, #ff8a8a, #e74c3c);
            box-shadow: 0 0 30px #ff6b6b, 0 6px 0 rgba(0,0,0,0.2);
        }

        #simon-blue {
            background: linear-gradient(145deg, #5dade2, #2980b9);
        }
        #simon-blue.active {
            background: linear-gradient(145deg, #85c1e9, #3498db);
            box-shadow: 0 0 30px #5dade2, 0 6px 0 rgba(0,0,0,0.2);
        }

        #simon-yellow {
            background: linear-gradient(145deg, #f4d03f, #d4ac0d);
        }
        #simon-yellow.active {
            background: linear-gradient(145deg, #f7dc6f, #f1c40f);
            box-shadow: 0 0 30px #f4d03f, 0 6px 0 rgba(0,0,0,0.2);
        }

        #simon-green {
            background: linear-gradient(145deg, #58d68d, #27ae60);
        }
        #simon-green.active {
            background: linear-gradient(145deg, #82e0aa, #2ecc71);
            box-shadow: 0 0 30px #58d68d, 0 6px 0 rgba(0,0,0,0.2);
        }

        .simon-btn.disabled {
            opacity: 0.6;
            cursor: not-allowed;
            pointer-events: none;
        }

        .throw-btn {
            background: var(--dancheong-green);
            color: white;
            border: none;
            padding: 20px 50px;
            border-radius: 30px;
            font-size: 1.5rem;
            font-weight: 700;
            cursor: pointer;
            margin: 20px 0;
            transition: all 0.3s ease;
            font-family: 'Noto Sans KR', sans-serif;
        }

        .throw-btn:hover {
            background: #1A3009;
            transform: scale(1.05);
        }

        .throw-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* ìˆ«ì ê¸°ì–µí•˜ê¸° */
        .memory-display {
            font-family: 'Noto Serif KR', serif;
            font-size: 4rem;
            text-align: center;
            padding: 40px;
            background: white;
            border-radius: 20px;
            margin: 20px 0;
            min-height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            letter-spacing: 15px;
            color: var(--dancheong-blue);
            border: 3px solid var(--gold-accent);
        }

        .memory-input {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .num-btn {
            width: 70px;
            height: 70px;
            font-size: 2rem;
            font-weight: bold;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            background: white;
            color: var(--ink-black);
            transition: all 0.2s ease;
            border: 2px solid #ddd;
            font-family: 'Noto Serif KR', serif;
        }

        .num-btn:hover {
            background: var(--dancheong-blue);
            color: white;
            border-color: var(--dancheong-blue);
        }

        .num-btn:active {
            transform: scale(0.95);
        }

        .user-answer {
            font-family: 'Noto Serif KR', serif;
            font-size: 2.5rem;
            text-align: center;
            margin: 20px 0;
            min-height: 50px;
            color: var(--dancheong-green);
            letter-spacing: 10px;
        }

        /* ì†ë‹´ ë§ì¶”ê¸° */
        .proverb-display {
            font-family: 'Noto Serif KR', serif;
            font-size: 2rem;
            text-align: center;
            padding: 30px;
            background: white;
            border-radius: 15px;
            margin: 20px 0;
            line-height: 1.8;
            border: 3px solid var(--gold-accent);
        }

        .proverb-blank {
            display: inline-block;
            min-width: 100px;
            border-bottom: 4px solid var(--dancheong-red);
            margin: 0 10px;
            color: var(--dancheong-red);
        }

        .proverb-options {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
        }

        .option-btn {
            background: white;
            border: 3px solid var(--dancheong-blue);
            padding: 15px 30px;
            border-radius: 15px;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Noto Serif KR', serif;
        }

        .option-btn:hover {
            background: var(--dancheong-blue);
            color: white;
        }

        .option-btn.correct {
            background: var(--dancheong-green);
            color: white;
            border-color: var(--dancheong-green);
        }

        .option-btn.wrong {
            background: var(--dancheong-red);
            color: white;
            border-color: var(--dancheong-red);
        }

        /* ì‚°ìˆ˜ ê³„ì‚° */
        .calc-problem {
            font-family: 'Noto Serif KR', serif;
            font-size: 3.5rem;
            text-align: center;
            padding: 40px;
            background: white;
            border-radius: 20px;
            margin: 20px 0;
            border: 3px solid var(--gold-accent);
        }

        .calc-input {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 30px 0;
        }

        .calc-answer {
            font-size: 2.5rem;
            padding: 15px 30px;
            border: 3px solid var(--dancheong-blue);
            border-radius: 15px;
            text-align: center;
            width: 150px;
            font-family: 'Noto Serif KR', serif;
        }

        .submit-btn {
            background: var(--dancheong-blue);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 15px;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Noto Sans KR', sans-serif;
            font-weight: 700;
        }

        .submit-btn:hover {
            background: #0D2A3A;
        }

        /* ìˆœì„œ ë§ì¶”ê¸° */
        .sequence-items {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
        }

        .seq-item {
            width: 100px;
            height: 100px;
            background: white;
            border: 3px solid var(--dancheong-yellow);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .seq-item:hover {
            transform: scale(1.1);
            border-color: var(--dancheong-red);
        }

        .seq-item.selected {
            background: var(--dancheong-yellow);
            border-color: var(--gold-accent);
            order: var(--order);
        }

        .selected-sequence {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            min-height: 80px;
            flex-wrap: wrap;
        }

        .selected-item {
            width: 70px;
            height: 70px;
            background: var(--dancheong-blue);
            color: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }

        /* ê²Œì„ ê²°ê³¼ */
        .game-result {
            text-align: center;
            padding: 30px;
            background: white;
            border-radius: 20px;
            margin-top: 20px;
            border: 3px solid var(--gold-accent);
        }

        .result-icon {
            font-size: 5rem;
            margin-bottom: 20px;
        }

        .result-text {
            font-family: 'Noto Serif KR', serif;
            font-size: 2rem;
            color: var(--ink-black);
            margin-bottom: 10px;
        }

        .result-score {
            font-size: 3rem;
            color: var(--dancheong-red);
            font-weight: 900;
        }

        .next-btn {
            background: var(--dancheong-green);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
            font-family: 'Noto Sans KR', sans-serif;
        }

        .next-btn:hover {
            background: #1A3009;
        }

        /* ê²Œì„ ì •ë³´ */
        .game-info-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: rgba(255,255,255,0.8);
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .game-timer, .game-level {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--ink-black);
        }

        .game-progress {
            height: 10px;
            background: #ddd;
            border-radius: 5px;
            overflow: hidden;
            flex: 1;
            margin: 0 20px;
        }

        .progress-bar {
            height: 100%;
            background: var(--dancheong-green);
            transition: width 0.3s ease;
        }

        /* ì•Œë¦¼ ë©”ì‹œì§€ */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--ink-black);
            color: white;
            padding: 20px 40px;
            border-radius: 15px;
            font-size: 1.2rem;
            z-index: 2000;
            transition: transform 0.3s ease;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
        }

        .toast.success { background: var(--dancheong-green); }
        .toast.error { background: var(--dancheong-red); }

        /* í‘¸í„° */
        .footer {
            text-align: center;
            padding: 30px;
            color: var(--wood-brown);
            font-size: 1rem;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .header h1 { font-size: 2rem; }
            .game-grid { grid-template-columns: 1fr; }
            .hwatu-grid { grid-template-columns: repeat(3, 1fr); }
            .scoreboard { flex-direction: column; text-align: center; }
            .memory-display { font-size: 2.5rem; letter-spacing: 8px; }
            .calc-problem { font-size: 2.5rem; }
            .proverb-display { font-size: 1.5rem; }
            .player-form { flex-direction: column; }
            .player-input { width: 100%; }
            
            /* ìƒ‰ìƒ íŒ¨í„´ ë²„íŠ¼ ëª¨ë°”ì¼ */
            .simon-board { max-width: 280px; gap: 10px; }
            .simon-btn { width: 120px; height: 120px; }
        }

        /* ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes shake {
            0%, 100% { transform: rotate(0); }
            25% { transform: rotate(-15deg); }
            75% { transform: rotate(15deg); }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .shake { animation: shake 0.5s ease; }
        .bounce { animation: bounce 0.5s ease; }
        .pulse { animation: pulse 0.3s ease; }

        /* =========================
           HeyGen/Netlify PIP Widget - ë“œë˜ê·¸ ìˆ˜ì • ë²„ì „
           ========================= */
        #heygen-pip-container {
          position: fixed;
          bottom: 20px;
          right: 20px;
          z-index: 9999;
          border-radius: 16px;
          overflow: visible;
          box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        #heygen-pip {
          width: 380px;
          height: 214px;
          border: none;
          border-radius: 16px;
          background: #1a1a2e;
          display: block;
        }

        /* ë“œë˜ê·¸ ì˜ì—­ - í…Œë‘ë¦¬ */
        .pip-drag-border {
          position: absolute;
          pointer-events: auto;
          cursor: grab;
        }

        .pip-drag-border:active {
          cursor: grabbing;
        }

        .pip-drag-border.top {
          top: 0;
          left: 0;
          right: 0;
          height: 25px;
          border-radius: 16px 16px 0 0;
        }

        .pip-drag-border.left {
          top: 25px;
          left: 0;
          bottom: 0;
          width: 8px;
        }

        .pip-drag-border.right {
          top: 25px;
          right: 0;
          bottom: 0;
          width: 8px;
        }

        .pip-drag-border.bottom {
          bottom: 0;
          left: 0;
          right: 0;
          height: 8px;
          border-radius: 0 0 16px 16px;
        }

        #heygen-pip-container.dragging {
          opacity: 0.9;
          box-shadow: 0 12px 40px rgba(0,0,0,0.4);
        }

        #heygen-pip-container.dragging .pip-drag-border {
          cursor: grabbing;
        }

        /* í˜¸ë²„ ì‹œ ì»¨íŠ¸ë¡¤ */
        .pip-controls {
          position: absolute;
          top: 8px;
          right: 8px;
          display: flex;
          gap: 6px;
          opacity: 0;
          transition: opacity 0.2s;
          pointer-events: none;
          z-index: 10;
        }

        #heygen-pip-container:hover .pip-controls {
          opacity: 1;
          pointer-events: auto;
        }

        .pip-ctrl-btn {
          width: 28px;
          height: 28px;
          border: none;
          border-radius: 50%;
          cursor: pointer;
          font-size: 14px;
          display: flex;
          align-items: center;
          justify-content: center;
          background: rgba(0,0,0,0.7);
          color: white;
          transition: all 0.2s;
        }

        .pip-ctrl-btn:hover {
          background: rgba(0,0,0,0.9);
          transform: scale(1.1);
        }

        .pip-ctrl-btn.close-btn:hover {
          background: #ff5252;
        }

        /* í˜¸ë²„ ê·¸ë¼ë°ì´ì…˜ */
        .pip-hover-gradient {
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          height: 50px;
          background: linear-gradient(180deg, rgba(0,0,0,0.6) 0%, transparent 100%);
          border-radius: 16px 16px 0 0;
          opacity: 0;
          transition: opacity 0.2s;
          pointer-events: none;
        }

        #heygen-pip-container:hover .pip-hover-gradient {
          opacity: 1;
        }

        /* ğŸ†• ìµœì†Œí™” - containerì™€ iframe ë‘˜ ë‹¤ ì„¤ì • */
        #heygen-pip-container.minimized {
          width: 120px !important;
          height: 68px !important;
        }

        #heygen-pip-container.minimized #heygen-pip {
          width: 120px !important;
          height: 68px !important;
        }

        /* ìˆ¨ê¹€ */
        #heygen-pip-container.hidden {
          display: none !important;
        }

        /* í† ê¸€ ë²„íŠ¼ */
        #heygen-pip-toggle {
          position: fixed;
          bottom: 20px;
          right: 20px;
          width: 64px;
          height: 64px;
          border-radius: 50%;
          border: none;
          cursor: pointer;
          z-index: 10000;
          display: none;
          align-items: center;
          justify-content: center;
          font-size: 28px;
          background: linear-gradient(135deg, #667eea, #764ba2);
          box-shadow: 0 4px 16px rgba(102, 126, 234, 0.4);
          transition: transform 0.2s;
        }

        #heygen-pip-toggle:hover {
          transform: scale(1.06);
        }

        #heygen-pip-container.hidden ~ #heygen-pip-toggle {
          display: flex !important;
        }

        @media (max-width: 768px) {
          #heygen-pip {
            width: 300px;
            height: 169px;
          }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- í—¤ë” -->
        <header class="header">
            <h1>ğŸ§  ë‘ë‡Œ ê±´ê°• ì „í†µë†€ì´</h1>
            <p>ì¦ê±°ìš´ ë†€ì´ë¡œ ê±´ê°•í•œ ë‘ë‡Œë¥¼!</p>
        </header>

        <!-- í”Œë ˆì´ì–´ ì„¹ì…˜ -->
        <div class="player-section">
            <div class="player-form" id="playerForm">
                <label for="playerName">ğŸ‘¤ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:</label>
                <input type="text" id="playerName" class="player-input" placeholder="ì˜ˆ: í™ê¸¸ë™" maxlength="20">
                <button class="player-btn" onclick="startGame()">ê²Œì„ ì‹œì‘</button>
                <button class="player-btn secondary" onclick="showRecordsModal()">ğŸ“Š ë‚´ ê¸°ë¡ ë³´ê¸°</button>
            </div>
            <div class="player-info" id="playerInfo">
                <span class="player-name-display" id="playerNameDisplay"></span>
                <span class="session-badge" id="sessionBadge">1íšŒì°¨</span>
                <button class="player-btn" onclick="changePlayer()">ë‹¤ë¥¸ ì´ë¦„ìœ¼ë¡œ</button>
            </div>
        </div>

        <!-- ì ìˆ˜íŒ -->
        <div class="scoreboard">
            <div class="score-item">
                <div class="score-label">ì™„ë£Œí•œ ê²Œì„</div>
                <div class="score-value" id="completedGames">0/6</div>
            </div>
            <div class="score-item">
                <div class="score-label">í˜„ì¬ íšŒì°¨</div>
                <div class="score-value" id="currentSession">-</div>
            </div>
            <div class="score-item total-score">
                <div class="score-label">ì´ ì ìˆ˜</div>
                <div class="score-value" id="totalScore">0</div>
            </div>
        </div>

        <!-- ì•¡ì…˜ ë²„íŠ¼ -->
        <div class="action-buttons">
            <button class="action-btn save" id="saveBtn" onclick="saveRecord()" disabled>
                ğŸ’¾ ê¸°ë¡ ì €ì¥í•˜ê¸°
            </button>
            <button class="action-btn ranking" onclick="showRankingModal()">
                ğŸ† ì „ì²´ ë­í‚¹
            </button>
            <button class="action-btn reset" onclick="resetGames()">
                ğŸ”„ ë‹¤ì‹œ ì‹œì‘
            </button>
        </div>

        <!-- ê²Œì„ ê·¸ë¦¬ë“œ -->
        <div class="game-grid" id="gameGrid">
            <!-- í™”íˆ¬ ì§ë§ì¶”ê¸° -->
            <div class="game-card disabled" id="card-hwatu" onclick="openGame('hwatu')">
                <div class="game-icon hwatu">ğŸ´</div>
                <div class="game-info">
                    <h3 class="game-title">í™”íˆ¬ ì§ë§ì¶”ê¸°</h3>
                    <p class="game-desc">ê°™ì€ ê·¸ë¦¼ì˜ í™”íˆ¬ íŒ¨ë¥¼ ì°¾ì•„ ì§ì„ ë§ì¶°ë³´ì„¸ìš”. ê¸°ì–µë ¥ì„ í‚¤ì›Œì¤ë‹ˆë‹¤!</p>
                    <div class="game-score">
                        <span class="points-badge">ìµœëŒ€ 100ì </span>
                        <button class="play-btn">ì‹œì‘í•˜ê¸°</button>
                    </div>
                </div>
            </div>

            <!-- ìƒ‰ìƒ íŒ¨í„´ ê¸°ì–µ -->
            <div class="game-card disabled" id="card-yut" onclick="openGame('yut')">
                <div class="game-icon yut">ğŸ¨</div>
                <div class="game-info">
                    <h3 class="game-title">ìƒ‰ìƒ íŒ¨í„´ ê¸°ì–µ</h3>
                    <p class="game-desc">ìƒ‰ìƒì´ ê¹œë¹¡ì´ëŠ” ìˆœì„œë¥¼ ê¸°ì–µí•˜ê³  ë”°ë¼í•´ ë³´ì„¸ìš”. ì§‘ì¤‘ë ¥ì„ í‚¤ì›Œì¤ë‹ˆë‹¤!</p>
                    <div class="game-score">
                        <span class="points-badge">ìµœëŒ€ 100ì </span>
                        <button class="play-btn">ì‹œì‘í•˜ê¸°</button>
                    </div>
                </div>
            </div>

            <!-- ìˆ«ì ê¸°ì–µí•˜ê¸° -->
            <div class="game-card disabled" id="card-memory" onclick="openGame('memory')">
                <div class="game-icon memory">ğŸ”¢</div>
                <div class="game-info">
                    <h3 class="game-title">ìˆ«ì ê¸°ì–µí•˜ê¸°</h3>
                    <p class="game-desc">í™”ë©´ì— ë‚˜íƒ€ë‚˜ëŠ” ìˆ«ìë¥¼ ìˆœì„œëŒ€ë¡œ ê¸°ì–µí•´ ë³´ì„¸ìš”!</p>
                    <div class="game-score">
                        <span class="points-badge">ìµœëŒ€ 100ì </span>
                        <button class="play-btn">ì‹œì‘í•˜ê¸°</button>
                    </div>
                </div>
            </div>

            <!-- ì†ë‹´ ì™„ì„±í•˜ê¸° -->
            <div class="game-card disabled" id="card-proverb" onclick="openGame('proverb')">
                <div class="game-icon proverb">ğŸ“œ</div>
                <div class="game-info">
                    <h3 class="game-title">ì†ë‹´ ì™„ì„±í•˜ê¸°</h3>
                    <p class="game-desc">ë¹ˆ ì¹¸ì— ë“¤ì–´ê°ˆ ì•Œë§ì€ ë§ì„ ì°¾ì•„ ì†ë‹´ì„ ì™„ì„±í•˜ì„¸ìš”!</p>
                    <div class="game-score">
                        <span class="points-badge">ìµœëŒ€ 100ì </span>
                        <button class="play-btn">ì‹œì‘í•˜ê¸°</button>
                    </div>
                </div>
            </div>

            <!-- ì‚°ìˆ˜ ê³„ì‚° -->
            <div class="game-card disabled" id="card-calc" onclick="openGame('calc')">
                <div class="game-icon calc">ğŸ§®</div>
                <div class="game-info">
                    <h3 class="game-title">ì‚°ìˆ˜ ê³„ì‚°</h3>
                    <p class="game-desc">ê°„ë‹¨í•œ ë§ì…ˆê³¼ ëº„ì…ˆ ë¬¸ì œë¥¼ í’€ì–´ë³´ì„¸ìš”. ë‘ë‡Œê°€ ì Šì–´ì§‘ë‹ˆë‹¤!</p>
                    <div class="game-score">
                        <span class="points-badge">ìµœëŒ€ 100ì </span>
                        <button class="play-btn">ì‹œì‘í•˜ê¸°</button>
                    </div>
                </div>
            </div>

            <!-- ìˆœì„œ ë§ì¶”ê¸° -->
            <div class="game-card disabled" id="card-sequence" onclick="openGame('sequence')">
                <div class="game-icon sequence">ğŸ”„</div>
                <div class="game-info">
                    <h3 class="game-title">ìˆœì„œ ë§ì¶”ê¸°</h3>
                    <p class="game-desc">ê·¸ë¦¼ì„ ì˜¬ë°”ë¥¸ ìˆœì„œëŒ€ë¡œ ë°°ì—´í•´ ë³´ì„¸ìš”. ë…¼ë¦¬ë ¥ì´ ì‘¥ì‘¥!</p>
                    <div class="game-score">
                        <span class="points-badge">ìµœëŒ€ 100ì </span>
                        <button class="play-btn">ì‹œì‘í•˜ê¸°</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- í‘¸í„° -->
        <footer class="footer">
            <p>ë§¤ì¼ ì¡°ê¸ˆì”©, ê±´ê°•í•œ ë‘ë‡Œë¥¼ ìœ„í•œ ì¦ê±°ìš´ ìŠµê´€ ğŸŒ¿</p>
        </footer>
    </div>

    <!-- í† ìŠ¤íŠ¸ ë©”ì‹œì§€ -->
    <div class="toast" id="toast"></div>

    <!-- ê²Œì„ ëª¨ë‹¬ë“¤ -->
    <!-- í™”íˆ¬ ì§ë§ì¶”ê¸° ëª¨ë‹¬ -->
    <div class="modal" id="modal-hwatu">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">ğŸ´ í™”íˆ¬ ì§ë§ì¶”ê¸°</h2>
                <button class="close-btn" onclick="closeGame('hwatu')">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="game-info-bar">
                    <span class="game-level">ë‚¨ì€ ì§: <span id="hwatu-pairs">6</span></span>
                    <div class="game-progress"><div class="progress-bar" id="hwatu-progress" style="width: 0%"></div></div>
                    <span class="game-timer">ì‹œë„: <span id="hwatu-tries">0</span></span>
                </div>
                <div class="hwatu-grid" id="hwatu-board"></div>
                <div class="game-result" id="hwatu-result" style="display: none;">
                    <div class="result-icon">ğŸ‰</div>
                    <div class="result-text">í›Œë¥­í•©ë‹ˆë‹¤!</div>
                    <div class="result-score">+<span id="hwatu-score">0</span>ì </div>
                    <button class="next-btn" onclick="closeGame('hwatu')">í™•ì¸</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ìƒ‰ìƒ íŒ¨í„´ ê¸°ì–µ ëª¨ë‹¬ -->
    <div class="modal" id="modal-yut">
        <div class="modal-content">
            <div class="modal-header" style="background: var(--dancheong-green);">
                <h2 class="modal-title">ğŸ¨ ìƒ‰ìƒ íŒ¨í„´ ê¸°ì–µ</h2>
                <button class="close-btn" onclick="closeGame('yut')">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="game-info-bar">
                    <span class="game-level">ë‹¨ê³„: <span id="yut-position">1</span>/5</span>
                    <div class="game-progress"><div class="progress-bar" id="yut-progress" style="width: 0%"></div></div>
                    <span class="game-timer">íŒ¨í„´ ê¸¸ì´: <span id="yut-throws">3</span></span>
                </div>
                <div class="simon-container">
                    <div class="simon-message" id="simon-message">ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”!</div>
                    <div class="simon-board" id="simon-board">
                        <div class="simon-btn" id="simon-red" data-color="red" onclick="simonClick('red')"></div>
                        <div class="simon-btn" id="simon-blue" data-color="blue" onclick="simonClick('blue')"></div>
                        <div class="simon-btn" id="simon-yellow" data-color="yellow" onclick="simonClick('yellow')"></div>
                        <div class="simon-btn" id="simon-green" data-color="green" onclick="simonClick('green')"></div>
                    </div>
                    <button class="throw-btn" id="throw-btn" onclick="startSimonRound()">ì‹œì‘!</button>
                </div>
                <div class="game-result" id="yut-result" style="display: none;">
                    <div class="result-icon">ğŸ†</div>
                    <div class="result-text">ì™„ë£Œ!</div>
                    <div class="result-score">+<span id="yut-score">0</span>ì </div>
                    <button class="next-btn" onclick="closeGame('yut')">í™•ì¸</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ìˆ«ì ê¸°ì–µí•˜ê¸° ëª¨ë‹¬ -->
    <div class="modal" id="modal-memory">
        <div class="modal-content">
            <div class="modal-header" style="background: var(--dancheong-yellow); color: var(--ink-black);">
                <h2 class="modal-title">ğŸ”¢ ìˆ«ì ê¸°ì–µí•˜ê¸°</h2>
                <button class="close-btn" style="color: var(--ink-black);" onclick="closeGame('memory')">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="game-info-bar">
                    <span class="game-level">ë‹¨ê³„: <span id="memory-level">1</span>/5</span>
                    <div class="game-progress"><div class="progress-bar" id="memory-progress" style="width: 0%"></div></div>
                    <span class="game-timer">ë§ì¶˜ ê°œìˆ˜: <span id="memory-correct">0</span></span>
                </div>
                <div class="memory-display" id="memory-display">ì¤€ë¹„...</div>
                <div class="user-answer" id="user-answer"></div>
                <div class="memory-input" id="memory-input" style="display: none;">
                    <button class="num-btn" onclick="inputNumber(1)">1</button>
                    <button class="num-btn" onclick="inputNumber(2)">2</button>
                    <button class="num-btn" onclick="inputNumber(3)">3</button>
                    <button class="num-btn" onclick="inputNumber(4)">4</button>
                    <button class="num-btn" onclick="inputNumber(5)">5</button>
                    <button class="num-btn" onclick="inputNumber(6)">6</button>
                    <button class="num-btn" onclick="inputNumber(7)">7</button>
                    <button class="num-btn" onclick="inputNumber(8)">8</button>
                    <button class="num-btn" onclick="inputNumber(9)">9</button>
                    <button class="num-btn" onclick="inputNumber(0)">0</button>
                    <button class="num-btn" onclick="clearAnswer()" style="background: var(--dancheong-red); color: white;">ì§€ìš°ê¸°</button>
                    <button class="num-btn" onclick="submitMemory()" style="background: var(--dancheong-green); color: white;">í™•ì¸</button>
                </div>
                <div class="game-result" id="memory-result" style="display: none;">
                    <div class="result-icon">ğŸ§ </div>
                    <div class="result-text">ëŒ€ë‹¨í•´ìš”!</div>
                    <div class="result-score">+<span id="memory-score">0</span>ì </div>
                    <button class="next-btn" onclick="closeGame('memory')">í™•ì¸</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ì†ë‹´ ì™„ì„±í•˜ê¸° ëª¨ë‹¬ -->
    <div class="modal" id="modal-proverb">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">ğŸ“œ ì†ë‹´ ì™„ì„±í•˜ê¸°</h2>
                <button class="close-btn" onclick="closeGame('proverb')">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="game-info-bar">
                    <span class="game-level">ë¬¸ì œ: <span id="proverb-num">1</span>/5</span>
                    <div class="game-progress"><div class="progress-bar" id="proverb-progress" style="width: 0%"></div></div>
                    <span class="game-timer">ë§ì¶˜ ê°œìˆ˜: <span id="proverb-correct">0</span></span>
                </div>
                <div class="proverb-display" id="proverb-display"></div>
                <div class="proverb-options" id="proverb-options"></div>
                <div class="game-result" id="proverb-result" style="display: none;">
                    <div class="result-icon">ğŸ“š</div>
                    <div class="result-text">ì§€í˜œë¡œì›Œìš”!</div>
                    <div class="result-score">+<span id="proverb-score">0</span>ì </div>
                    <button class="next-btn" onclick="closeGame('proverb')">í™•ì¸</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ì‚°ìˆ˜ ê³„ì‚° ëª¨ë‹¬ -->
    <div class="modal" id="modal-calc">
        <div class="modal-content">
            <div class="modal-header" style="background: #6B4423;">
                <h2 class="modal-title">ğŸ§® ì‚°ìˆ˜ ê³„ì‚°</h2>
                <button class="close-btn" onclick="closeGame('calc')">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="game-info-bar">
                    <span class="game-level">ë¬¸ì œ: <span id="calc-num">1</span>/5</span>
                    <div class="game-progress"><div class="progress-bar" id="calc-progress" style="width: 0%"></div></div>
                    <span class="game-timer">ë§ì¶˜ ê°œìˆ˜: <span id="calc-correct">0</span></span>
                </div>
                <div class="calc-problem" id="calc-problem"></div>
                <div class="calc-input">
                    <input type="number" class="calc-answer" id="calc-answer" placeholder="?">
                    <button class="submit-btn" onclick="submitCalc()">ì •ë‹µ í™•ì¸</button>
                </div>
                <div class="game-result" id="calc-result" style="display: none;">
                    <div class="result-icon">ğŸ“</div>
                    <div class="result-text">ë˜‘ë˜’í•´ìš”!</div>
                    <div class="result-score">+<span id="calc-score">0</span>ì </div>
                    <button class="next-btn" onclick="closeGame('calc')">í™•ì¸</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ìˆœì„œ ë§ì¶”ê¸° ëª¨ë‹¬ -->
    <div class="modal" id="modal-sequence">
        <div class="modal-content">
            <div class="modal-header" style="background: #4A1942;">
                <h2 class="modal-title">ğŸ”„ ìˆœì„œ ë§ì¶”ê¸°</h2>
                <button class="close-btn" onclick="closeGame('sequence')">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="game-info-bar">
                    <span class="game-level">ë¬¸ì œ: <span id="seq-num">1</span>/3</span>
                    <div class="game-progress"><div class="progress-bar" id="seq-progress" style="width: 0%"></div></div>
                    <span class="game-timer">ë§ì¶˜ ê°œìˆ˜: <span id="seq-correct">0</span></span>
                </div>
                <p style="text-align: center; margin-bottom: 20px; font-size: 1.2rem; color: var(--ink-black);" id="seq-instruction">ì•„ë˜ ê·¸ë¦¼ì„ ìˆœì„œëŒ€ë¡œ í´ë¦­í•˜ì„¸ìš”!</p>
                <div class="sequence-items" id="sequence-items"></div>
                <div class="selected-sequence" id="selected-sequence"></div>
                <div style="text-align: center;">
                    <button class="submit-btn" onclick="resetSequence()" style="background: var(--dancheong-red);">ë‹¤ì‹œ ì„ íƒ</button>
                    <button class="submit-btn" onclick="submitSequence()" style="margin-left: 10px;">ì •ë‹µ í™•ì¸</button>
                </div>
                <div class="game-result" id="sequence-result" style="display: none;">
                    <div class="result-icon">ğŸŒŸ</div>
                    <div class="result-text">ë…¼ë¦¬ì™•!</div>
                    <div class="result-score">+<span id="sequence-score">0</span>ì </div>
                    <button class="next-btn" onclick="closeGame('sequence')">í™•ì¸</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ë­í‚¹ ëª¨ë‹¬ -->
    <div class="modal" id="modal-ranking">
        <div class="modal-content">
            <div class="modal-header blue">
                <h2 class="modal-title">ğŸ† ì „ì²´ ë­í‚¹</h2>
                <button class="close-btn" onclick="closeModal('ranking')">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="tabs">
                    <button class="tab-btn active" onclick="showTab('ranking', 'all')">ì „ì²´ ë­í‚¹</button>
                    <button class="tab-btn" onclick="showTab('ranking', 'today')">ì˜¤ëŠ˜ì˜ ê¸°ë¡</button>
                </div>
                <div class="tab-content active" id="ranking-all">
                    <table class="ranking-table">
                        <thead>
                            <tr>
                                <th>ìˆœìœ„</th>
                                <th>ì´ë¦„</th>
                                <th>ìµœê³ ì ìˆ˜</th>
                                <th>í”Œë ˆì´íšŸìˆ˜</th>
                                <th>í‰ê· ì ìˆ˜</th>
                            </tr>
                        </thead>
                        <tbody id="ranking-body"></tbody>
                    </table>
                </div>
                <div class="tab-content" id="ranking-today">
                    <table class="ranking-table">
                        <thead>
                            <tr>
                                <th>ìˆœìœ„</th>
                                <th>ì´ë¦„</th>
                                <th>íšŒì°¨</th>
                                <th>ì´ì </th>
                                <th>ì‹œê°„</th>
                            </tr>
                        </thead>
                        <tbody id="today-body"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- ë‚´ ê¸°ë¡ ëª¨ë‹¬ -->
    <div class="modal" id="modal-records">
        <div class="modal-content">
            <div class="modal-header green">
                <h2 class="modal-title">ğŸ“Š ë‚´ ê¸°ë¡</h2>
                <button class="close-btn" onclick="closeModal('records')">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="tabs">
                    <button class="tab-btn active" onclick="showTab('records', 'history')">ê¸°ë¡ ëª©ë¡</button>
                    <button class="tab-btn" onclick="showTab('records', 'stats')">í†µê³„</button>
                </div>
                <div class="tab-content active" id="records-history">
                    <div id="records-list"></div>
                </div>
                <div class="tab-content" id="records-stats">
                    <div id="stats-content"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API ê¸°ë³¸ URL (ê°™ì€ í´ë”ì— ìˆëŠ” ê²½ìš°)
        const API_URL = 'api.php';

        // ê²Œì„ ìƒíƒœ ê´€ë¦¬
        let gameState = {
            playerName: '',
            sessionNumber: 0,
            totalScore: 0,
            completedGames: [],
            hwatu: { score: 0, completed: false },
            yut: { score: 0, completed: false },
            memory: { score: 0, completed: false },
            proverb: { score: 0, completed: false },
            calc: { score: 0, completed: false },
            sequence: { score: 0, completed: false }
        };

        // í† ìŠ¤íŠ¸ ë©”ì‹œì§€
        function showToast(message, type = '') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast ' + type;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // í”Œë ˆì´ì–´ ê´€ë¦¬
        function startGame() {
            const name = document.getElementById('playerName').value.trim();
            if (!name) {
                showToast('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!', 'error');
                return;
            }
            
            gameState.playerName = name;
            document.getElementById('playerForm').style.display = 'none';
            document.getElementById('playerInfo').classList.add('active');
            document.getElementById('playerNameDisplay').textContent = name + ' ë‹˜';
            
            // ê²Œì„ ì¹´ë“œ í™œì„±í™”
            document.querySelectorAll('.game-card').forEach(card => {
                card.classList.remove('disabled');
            });
            
            // íšŒì°¨ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            fetchSessionNumberAndStartAvatar();
            showToast(`${name}ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤! ğŸ‰`, 'success');
        }

        function changePlayer() {
            if (gameState.completedGames.length > 0 && !gameState.saved) {
                if (!confirm('ì €ì¥í•˜ì§€ ì•Šì€ ê¸°ë¡ì´ ìˆìŠµë‹ˆë‹¤. ì •ë§ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    return;
                }
            }
            
            // ğŸ†• ì´ë¦„ ë¨¼ì € ë¹„ìš°ê¸°!
            gameState.playerName = '';
            
            // ğŸ†• ì•„ë°”íƒ€ ë¦¬ì…‹ ì‹ í˜¸ ë³´ë‚´ê¸°
            document.getElementById('heygen-pip').contentWindow.postMessage({ 
                type: 'RESET_AVATAR'
            }, '*');
            
            resetGames();
            // gameState.playerName = ''; â† ì‚­ì œ (ìœ„ë¡œ ì´ë™)
            
            document.getElementById('playerForm').style.display = 'flex';
            document.getElementById('playerInfo').classList.remove('active');
            document.getElementById('playerName').value = '';
            
            // ê²Œì„ ì¹´ë“œ ë¹„í™œì„±í™”
            document.querySelectorAll('.game-card').forEach(card => {
                card.classList.add('disabled');
            });
        }

                // ğŸ†• PIPì— ì‚¬ìš©ì ì •ë³´ ì „ì†¡í•˜ëŠ” í•¨ìˆ˜
        function sendUserInfoToPIP(name, sessionNumber, stats) {
            const pipIframe = document.getElementById('ai-pip-iframe');
            if (pipIframe && pipIframe.contentWindow) {
                pipIframe.contentWindow.postMessage({
                    type: 'USER_INFO',
                    name: name,
                    session: sessionNumber,
                    isNewUser: sessionNumber === 1,
                    stats: stats || null
                }, '*');
                console.log('ğŸ“¤ PIPì— ì‚¬ìš©ì ì •ë³´ ì „ì†¡:', { name, sessionNumber, stats });
            }
        }

        async function fetchSessionNumberAndStartAvatar() {
            let stats = null;
            
            try {
                const response = await fetch(`${API_URL}?action=get_stats&player_name=${encodeURIComponent(gameState.playerName)}`);
                const data = await response.json();
                
                if (data.success && data.stats && data.stats.total_games) {
                    gameState.sessionNumber = parseInt(data.stats.total_games) + 1;
                    stats = data.stats;
                } else {
                    gameState.sessionNumber = 1;
                }
                
                document.getElementById('sessionBadge').textContent = `${gameState.sessionNumber}íšŒì°¨`;
                document.getElementById('currentSession').textContent = gameState.sessionNumber;
                
            } catch (error) {
                gameState.sessionNumber = 1;
                document.getElementById('sessionBadge').textContent = '1íšŒì°¨';
                document.getElementById('currentSession').textContent = '1';
            }
            
            // stats í¬í•¨í•´ì„œ ì•„ë°”íƒ€ ì‹œì‘
            document.getElementById('heygen-pip').contentWindow.postMessage({ 
                type: 'START_AVATAR',
                name: gameState.playerName,
                stats: stats
            }, '*');
        }

        // ì ìˆ˜ ì—…ë°ì´íŠ¸
        function updateScoreboard() {
            document.getElementById('totalScore').textContent = gameState.totalScore;
            document.getElementById('completedGames').textContent = `${gameState.completedGames.length}/6`;
            
            // ì €ì¥ ë²„íŠ¼ í™œì„±í™”
            if (gameState.completedGames.length === 6) {
                document.getElementById('saveBtn').disabled = false;
            }
        }

        // ê¸°ë¡ ì €ì¥
        async function saveRecord() {
            if (gameState.completedGames.length < 6) {
                showToast('ëª¨ë“  ê²Œì„ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”!', 'error');
                return;
            }
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'save',
                        player_name: gameState.playerName,
                        hwatu_score: gameState.hwatu.score,
                        pattern_score: gameState.yut.score,
                        memory_score: gameState.memory.score,
                        proverb_score: gameState.proverb.score,
                        calc_score: gameState.calc.score,
                        sequence_score: gameState.sequence.score
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showToast(`ê¸°ë¡ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! (${data.session_number}íšŒì°¨)`, 'success');
                    gameState.saved = true;
                    document.getElementById('saveBtn').disabled = true;
                    document.getElementById('saveBtn').textContent = 'âœ“ ì €ì¥ ì™„ë£Œ';
                } else {
                    showToast(data.error || 'ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            } catch (error) {
                showToast('ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                console.error(error);
            }
        }

        // ë­í‚¹ ëª¨ë‹¬
        async function showRankingModal() {
            document.getElementById('modal-ranking').classList.add('active');
            loadRanking();
        }

        async function loadRanking() {
            try {
                const response = await fetch(`${API_URL}?action=get_ranking`);
                const data = await response.json();
                
                if (data.success) {
                    const tbody = document.getElementById('ranking-body');
                    tbody.innerHTML = '';
                    
                    data.ranking.forEach((item, index) => {
                        const rankClass = index < 3 ? `rank-${index + 1}` : '';
                        const medal = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : `${index + 1}`;
                        
                        tbody.innerHTML += `
                            <tr class="${rankClass}">
                                <td>${medal}</td>
                                <td>${item.player_name}</td>
                                <td>${item.best_score}ì </td>
                                <td>${item.play_count}íšŒ</td>
                                <td>${Math.round(item.avg_score)}ì </td>
                            </tr>
                        `;
                    });
                }
            } catch (error) {
                console.error(error);
            }
            
            // ì˜¤ëŠ˜ ê¸°ë¡ë„ ë¡œë“œ
            loadTodayRecords();
        }

        async function loadTodayRecords() {
            try {
                const response = await fetch(`${API_URL}?action=get_today`);
                const data = await response.json();
                
                if (data.success) {
                    const tbody = document.getElementById('today-body');
                    tbody.innerHTML = '';
                    
                    data.records.forEach((item, index) => {
                        const time = new Date(item.created_at).toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
                        
                        tbody.innerHTML += `
                            <tr>
                                <td>${index + 1}</td>
                                <td>${item.player_name}</td>
                                <td>${item.session_number}íšŒì°¨</td>
                                <td>${item.total_score}ì </td>
                                <td>${time}</td>
                            </tr>
                        `;
                    });
                    
                    if (data.records.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="5">ì˜¤ëŠ˜ì˜ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                    }
                }
            } catch (error) {
                console.error(error);
            }
        }

        // ë‚´ ê¸°ë¡ ëª¨ë‹¬
        async function showRecordsModal() {
            const name = gameState.playerName || document.getElementById('playerName').value.trim();
            
            if (!name) {
                showToast('ì´ë¦„ì„ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”!', 'error');
                return;
            }
            
            document.getElementById('modal-records').classList.add('active');
            loadMyRecords(name);
            loadMyStats(name);
        }

        async function loadMyRecords(name) {
            try {
                const response = await fetch(`${API_URL}?action=get_records&player_name=${encodeURIComponent(name)}`);
                const data = await response.json();
                
                const container = document.getElementById('records-list');
                
                if (data.success && data.records.length > 0) {
                    container.innerHTML = '';
                    
                    data.records.forEach(record => {
                        const date = new Date(record.created_at).toLocaleString('ko-KR');
                        
                        container.innerHTML += `
                            <div class="record-card">
                                <div class="record-header">
                                    <span class="record-session">${record.session_number}íšŒì°¨</span>
                                    <span class="record-date">${date}</span>
                                </div>
                                <div class="record-scores">
                                    <div class="record-score-item">
                                        <div class="label">ğŸ´ í™”íˆ¬</div>
                                        <div class="value">${record.hwatu_score}</div>
                                    </div>
                                    <div class="record-score-item">
                                        <div class="label">ğŸ¨ ìƒ‰ìƒ íŒ¨í„´</div>
                                        <div class="value">${record.pattern_score}</div>
                                    </div>
                                    <div class="record-score-item">
                                        <div class="label">ğŸ”¢ ìˆ«ìê¸°ì–µ</div>
                                        <div class="value">${record.memory_score}</div>
                                    </div>
                                    <div class="record-score-item">
                                        <div class="label">ğŸ“œ ì†ë‹´</div>
                                        <div class="value">${record.proverb_score}</div>
                                    </div>
                                    <div class="record-score-item">
                                        <div class="label">ğŸ§® ì‚°ìˆ˜</div>
                                        <div class="value">${record.calc_score}</div>
                                    </div>
                                    <div class="record-score-item">
                                        <div class="label">ğŸ”„ ìˆœì„œ</div>
                                        <div class="value">${record.sequence_score}</div>
                                    </div>
                                </div>
                                <div class="record-total">ì´ì : ${record.total_score}ì </div>
                            </div>
                        `;
                    });
                } else {
                    container.innerHTML = '<p style="text-align: center; padding: 40px; color: #888;">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤. ê²Œì„ì„ í”Œë ˆì´í•´ë³´ì„¸ìš”!</p>';
                }
            } catch (error) {
                console.error(error);
            }
        }

        async function loadMyStats(name) {
            try {
                const response = await fetch(`${API_URL}?action=get_stats&player_name=${encodeURIComponent(name)}`);
                const data = await response.json();
                
                const container = document.getElementById('stats-content');
                
                if (data.success && data.stats.total_games > 0) {
                    const stats = data.stats;
                    
                    container.innerHTML = `
                        <div class="record-card">
                            <h3 style="margin-bottom: 20px; font-family: 'Noto Serif KR', serif; color: var(--dancheong-blue);">ğŸ“Š ${name}ë‹˜ì˜ í†µê³„</h3>
                            <div class="record-scores">
                                <div class="record-score-item">
                                    <div class="label">ì´ í”Œë ˆì´</div>
                                    <div class="value">${stats.total_games}íšŒ</div>
                                </div>
                                <div class="record-score-item">
                                    <div class="label">ìµœê³  ì ìˆ˜</div>
                                    <div class="value" style="color: var(--dancheong-red);">${stats.best_score}ì </div>
                                </div>
                                <div class="record-score-item">
                                    <div class="label">í‰ê·  ì ìˆ˜</div>
                                    <div class="value">${Math.round(stats.avg_score)}ì </div>
                                </div>
                            </div>
                            <h4 style="margin: 20px 0 15px; color: #666;">ğŸ… ê²Œì„ë³„ ìµœê³  ê¸°ë¡</h4>
                            <div class="record-scores">
                                <div class="record-score-item">
                                    <div class="label">ğŸ´ í™”íˆ¬</div>
                                    <div class="value">${stats.best_hwatu || 0}</div>
                                </div>
                                <div class="record-score-item">
                                    <div class="label">ğŸ¨ ìƒ‰ìƒ íŒ¨í„´</div>
                                    <div class="value">${stats.best_pattern || 0}</div>
                                </div>
                                <div class="record-score-item">
                                    <div class="label">ğŸ”¢ ìˆ«ìê¸°ì–µ</div>
                                    <div class="value">${stats.best_memory || 0}</div>
                                </div>
                                <div class="record-score-item">
                                    <div class="label">ğŸ“œ ì†ë‹´</div>
                                    <div class="value">${stats.best_proverb || 0}</div>
                                </div>
                                <div class="record-score-item">
                                    <div class="label">ğŸ§® ì‚°ìˆ˜</div>
                                    <div class="value">${stats.best_calc || 0}</div>
                                </div>
                                <div class="record-score-item">
                                    <div class="label">ğŸ”„ ìˆœì„œ</div>
                                    <div class="value">${stats.best_sequence || 0}</div>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    container.innerHTML = '<p style="text-align: center; padding: 40px; color: #888;">í†µê³„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
            } catch (error) {
                console.error(error);
            }
        }

        // íƒ­ ì „í™˜
        function showTab(modal, tabName) {
            const prefix = modal === 'ranking' ? 'ranking' : 'records';
            
            document.querySelectorAll(`#modal-${modal} .tab-btn`).forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll(`#modal-${modal} .tab-content`).forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`${prefix}-${tabName}`).classList.add('active');
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        function closeModal(type) {
            document.getElementById(`modal-${type}`).classList.remove('active');
        }

        // ê²Œì„ ë¦¬ì…‹
        function resetGames() {
            gameState.totalScore = 0;
            gameState.completedGames = [];
            gameState.saved = false;
            gameState.hwatu = { score: 0, completed: false };
            gameState.yut = { score: 0, completed: false };
            gameState.memory = { score: 0, completed: false };
            gameState.proverb = { score: 0, completed: false };
            gameState.calc = { score: 0, completed: false };
            gameState.sequence = { score: 0, completed: false };
            
            document.querySelectorAll('.game-card').forEach(card => {
                card.classList.remove('completed');
            });
            
            document.getElementById('saveBtn').disabled = true;
            document.getElementById('saveBtn').textContent = 'ğŸ’¾ ê¸°ë¡ ì €ì¥í•˜ê¸°';
            
            if (gameState.playerName) {
                fetchSessionNumberAndStartAvatar();
            }
            
            updateScoreboard();
            showToast('ê²Œì„ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        }

        // ê²Œì„ ì—´ê¸°/ë‹«ê¸°
        function openGame(gameType) {
            if (!gameState.playerName) {
                showToast('ë¨¼ì € ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!', 'error');
                return;
            }
            if (gameState[gameType].completed) return;
                // ğŸ†• ì•„ë°”íƒ€ì—ê²Œ ê²Œì„ ì„¤ëª… ìš”ì²­
            document.getElementById('heygen-pip').contentWindow.postMessage({ 
                type: 'EXPLAIN_GAME',
                game: gameType
            }, '*');
            document.getElementById(`modal-${gameType}`).classList.add('active');
            initGame(gameType);
        }

        function closeGame(gameType) {
            document.getElementById(`modal-${gameType}`).classList.remove('active');
            if (gameState[gameType].completed && !gameState.completedGames.includes(gameType)) {
                gameState.completedGames.push(gameType);
                document.getElementById(`card-${gameType}`).classList.add('completed');
                updateScoreboard();
            }
        }

        // ê²Œì„ ì´ˆê¸°í™”
        function initGame(gameType) {
            switch(gameType) {
                case 'hwatu': initHwatu(); break;
                case 'yut': initYut(); break;
                case 'memory': initMemory(); break;
                case 'proverb': initProverb(); break;
                case 'calc': initCalc(); break;
                case 'sequence': initSequence(); break;
            }
        }

        // ============================================
        // 1. í™”íˆ¬ ì§ë§ì¶”ê¸°
        // ============================================
        let hwatuState = {
            cards: [],
            flipped: [],
            matched: 0,
            tries: 0
        };

        const hwatuSymbols = ['ğŸŒ¸', 'ğŸ‚', 'ğŸŒ™', 'ğŸŒŠ', 'ğŸ¦Œ', 'ğŸ—'];

        function initHwatu() {
            hwatuState = { cards: [], flipped: [], matched: 0, tries: 0, canClick: false };
            document.getElementById('hwatu-result').style.display = 'none';
            
            let symbols = [...hwatuSymbols, ...hwatuSymbols];
            symbols.sort(() => Math.random() - 0.5);
            
            const board = document.getElementById('hwatu-board');
            board.innerHTML = '';
            
            symbols.forEach((symbol, index) => {
                const card = document.createElement('div');
                card.className = 'hwatu-card';
                card.dataset.index = index;
                card.dataset.symbol = symbol;
                card.onclick = () => flipCard(index);
                board.appendChild(card);
                hwatuState.cards.push({ symbol, flipped: false, matched: false });
            });
            
            updateHwatuUI();
            
            // ğŸ´ ë¯¸ë¦¬ë³´ê¸°: 3ì´ˆê°„ ëª¨ë“  ì¹´ë“œ ê³µê°œ
            showAllCards();
        }

        function showAllCards() {
            const cards = document.querySelectorAll('.hwatu-card');
            
            // ëª¨ë“  ì¹´ë“œ ë’¤ì§‘ì–´ì„œ ë³´ì—¬ì£¼ê¸°
            cards.forEach((card, index) => {
                card.classList.add('flipped', 'preview');
                card.textContent = hwatuState.cards[index].symbol;
                card.style.fontSize = '3rem';
            });
            
            // ì¹´ìš´íŠ¸ë‹¤ìš´ í‘œì‹œ
            let countdown = 3;
            const countdownDiv = document.createElement('div');
            countdownDiv.id = 'hwatu-countdown';
            countdownDiv.style.cssText = `
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                font-size: 5rem;
                font-weight: bold;
                color: var(--dancheong-red);
                text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
                z-index: 100;
                background: rgba(255,255,255,0.9);
                padding: 20px 40px;
                border-radius: 20px;
                font-family: 'Noto Serif KR', serif;
            `;
            countdownDiv.textContent = `${countdown}ì´ˆ`;
            document.getElementById('hwatu-board').style.position = 'relative';
            document.getElementById('hwatu-board').appendChild(countdownDiv);
            
            const timer = setInterval(() => {
                countdown--;
                if (countdown > 0) {
                    countdownDiv.textContent = `${countdown}ì´ˆ`;
                } else {
                    clearInterval(timer);
                    countdownDiv.remove();
                    
                    // ëª¨ë“  ì¹´ë“œ ë‹¤ì‹œ ë’¤ì§‘ê¸°
                    cards.forEach((card) => {
                        card.classList.remove('flipped', 'preview');
                        card.textContent = '';
                    });
                    
                    // ì´ì œ í´ë¦­ ê°€ëŠ¥
                    hwatuState.canClick = true;
                }
            }, 1000);
        }

        function flipCard(index) {
            // ë¯¸ë¦¬ë³´ê¸° ì¤‘ì´ë©´ í´ë¦­ ë¬´ì‹œ
            if (!hwatuState.canClick) return;
            if (hwatuState.flipped.length >= 2) return;
            if (hwatuState.cards[index].flipped || hwatuState.cards[index].matched) return;
            
            hwatuState.cards[index].flipped = true;
            hwatuState.flipped.push(index);
            
            const card = document.querySelector(`[data-index="${index}"]`);
            card.classList.add('flipped');
            card.textContent = hwatuState.cards[index].symbol;
            card.style.fontSize = '3rem';
            
            if (hwatuState.flipped.length === 2) {
                hwatuState.tries++;
                checkMatch();
            }
            
            updateHwatuUI();
        }

        function checkMatch() {
            const [i1, i2] = hwatuState.flipped;
            
            if (hwatuState.cards[i1].symbol === hwatuState.cards[i2].symbol) {
                hwatuState.cards[i1].matched = true;
                hwatuState.cards[i2].matched = true;
                hwatuState.matched++;
                
                document.querySelector(`[data-index="${i1}"]`).classList.add('matched');
                document.querySelector(`[data-index="${i2}"]`).classList.add('matched');
                
                hwatuState.flipped = [];
                
                if (hwatuState.matched === 6) {
                    endHwatu();
                }
            } else {
                setTimeout(() => {
                    hwatuState.cards[i1].flipped = false;
                    hwatuState.cards[i2].flipped = false;
                    
                    const card1 = document.querySelector(`[data-index="${i1}"]`);
                    const card2 = document.querySelector(`[data-index="${i2}"]`);
                    card1.classList.remove('flipped');
                    card2.classList.remove('flipped');
                    card1.textContent = '';
                    card2.textContent = '';
                    
                    hwatuState.flipped = [];
                }, 1000);
            }
        }

        function updateHwatuUI() {
            document.getElementById('hwatu-pairs').textContent = 6 - hwatuState.matched;
            document.getElementById('hwatu-tries').textContent = hwatuState.tries;
            document.getElementById('hwatu-progress').style.width = `${(hwatuState.matched / 6) * 100}%`;
        }

        function endHwatu() {
            const score = Math.max(100 - (hwatuState.tries - 6) * 5, 50);
            gameState.hwatu.score = score;
            gameState.hwatu.completed = true;
            gameState.totalScore += score;
            
            document.getElementById('hwatu-score').textContent = score;
            document.getElementById('hwatu-result').style.display = 'block';
        }

        // ============================================
        // 2. ìƒ‰ìƒ íŒ¨í„´ ê¸°ì–µ (Simon Game)
        // ============================================
        let simonState = {
            sequence: [],
            playerSequence: [],
            level: 1,
            maxLevel: 5,
            isPlaying: false,
            canClick: false,
            correct: 0
        };

        const simonColors = ['red', 'blue', 'yellow', 'green'];

        function initYut() {
            // ì´ë¦„ì€ yutìœ¼ë¡œ ìœ ì§€ (ê¸°ì¡´ ì‹œìŠ¤í…œê³¼ í˜¸í™˜)
            simonState = {
                sequence: [],
                playerSequence: [],
                level: 1,
                maxLevel: 5,
                isPlaying: false,
                canClick: false,
                correct: 0
            };
            document.getElementById('yut-result').style.display = 'none';
            document.getElementById('simon-message').textContent = 'ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”!';
            document.getElementById('throw-btn').disabled = false;
            document.getElementById('throw-btn').textContent = 'ì‹œì‘!';
            
            // ëª¨ë“  ë²„íŠ¼ í™œì„±í™” ìƒíƒœë¡œ ì´ˆê¸°í™”
            simonColors.forEach(color => {
                document.getElementById(`simon-${color}`).classList.remove('active', 'disabled');
            });
            
            updateSimonUI();
        }

        function updateSimonUI() {
            document.getElementById('yut-position').textContent = simonState.level;
            document.getElementById('yut-throws').textContent = simonState.level + 2;
            document.getElementById('yut-progress').style.width = `${((simonState.level - 1) / simonState.maxLevel) * 100}%`;
        }

        function startSimonRound() {
            if (simonState.isPlaying) return;
            
            simonState.isPlaying = true;
            simonState.canClick = false;
            simonState.playerSequence = [];
            
            document.getElementById('throw-btn').disabled = true;
            document.getElementById('simon-message').textContent = 'íŒ¨í„´ì„ ì˜ ë³´ì„¸ìš”...';
            
            // ë²„íŠ¼ ë¹„í™œì„±í™”
            simonColors.forEach(color => {
                document.getElementById(`simon-${color}`).classList.add('disabled');
            });
            
            // ìƒˆ ìƒ‰ìƒ ì¶”ê°€ (ë ˆë²¨ + 2ê°œ)
            const patternLength = simonState.level + 2;
            simonState.sequence = [];
            for (let i = 0; i < patternLength; i++) {
                simonState.sequence.push(simonColors[Math.floor(Math.random() * 4)]);
            }
            
            // íŒ¨í„´ ë³´ì—¬ì£¼ê¸°
            setTimeout(() => {
                playSequence();
            }, 500);
        }

        function playSequence() {
            let i = 0;
            const interval = setInterval(() => {
                if (i < simonState.sequence.length) {
                    flashColor(simonState.sequence[i]);
                    i++;
                } else {
                    clearInterval(interval);
                    // í”Œë ˆì´ì–´ ì°¨ë¡€
                    setTimeout(() => {
                        document.getElementById('simon-message').textContent = 'ì´ì œ ë”°ë¼í•˜ì„¸ìš”!';
                        simonState.canClick = true;
                        
                        // ë²„íŠ¼ í™œì„±í™”
                        simonColors.forEach(color => {
                            document.getElementById(`simon-${color}`).classList.remove('disabled');
                        });
                    }, 500);
                }
            }, 800);
        }

        function flashColor(color) {
            const btn = document.getElementById(`simon-${color}`);
            btn.classList.add('active');
            
            setTimeout(() => {
                btn.classList.remove('active');
            }, 400);
        }

        function simonClick(color) {
            if (!simonState.canClick) return;
            
            // í´ë¦­ íš¨ê³¼
            flashColor(color);
            
            // í”Œë ˆì´ì–´ ì‹œí€€ìŠ¤ì— ì¶”ê°€
            simonState.playerSequence.push(color);
            
            const currentIndex = simonState.playerSequence.length - 1;
            
            // í‹€ë ¸ëŠ”ì§€ í™•ì¸
            if (simonState.playerSequence[currentIndex] !== simonState.sequence[currentIndex]) {
                // í‹€ë¦¼!
                simonState.canClick = false;
                document.getElementById('simon-message').textContent = 'ğŸ˜¢ í‹€ë ¸ìŠµë‹ˆë‹¤!';
                
                // ë²„íŠ¼ ë¹„í™œì„±í™”
                simonColors.forEach(c => {
                    document.getElementById(`simon-${c}`).classList.add('disabled');
                });
                
                setTimeout(() => {
                    endSimon();
                }, 1000);
                return;
            }
            
            // ì „ì²´ ì‹œí€€ìŠ¤ ì™„ë£Œ í™•ì¸
            if (simonState.playerSequence.length === simonState.sequence.length) {
                simonState.canClick = false;
                simonState.correct++;
                
                // ë²„íŠ¼ ë¹„í™œì„±í™”
                simonColors.forEach(c => {
                    document.getElementById(`simon-${c}`).classList.add('disabled');
                });
                
                if (simonState.level >= simonState.maxLevel) {
                    // ê²Œì„ ì™„ë£Œ!
                    document.getElementById('simon-message').textContent = 'ğŸ‰ í›Œë¥­í•©ë‹ˆë‹¤!';
                    setTimeout(() => {
                        endSimon();
                    }, 1000);
                } else {
                    // ë‹¤ìŒ ë ˆë²¨
                    document.getElementById('simon-message').textContent = 'âœ¨ ì •ë‹µ! ë‹¤ìŒ ë‹¨ê³„ë¡œ...';
                    simonState.level++;
                    simonState.isPlaying = false;
                    
                    updateSimonUI();
                    
                    setTimeout(() => {
                        startSimonRound();
                    }, 1500);
                }
            }
        }

        function endSimon() {
            simonState.isPlaying = false;
            simonState.canClick = false;
            
            // ì ìˆ˜ ê³„ì‚°: ë§ì¶˜ ë ˆë²¨ * 20ì 
            const score = Math.min(simonState.correct * 20, 100);
            gameState.yut.score = score;
            gameState.yut.completed = true;
            gameState.totalScore += score;
            
            document.getElementById('yut-score').textContent = score;
            document.getElementById('yut-result').style.display = 'block';
        }

        // ============================================
        // 3. ìˆ«ì ê¸°ì–µí•˜ê¸°
        // ============================================
        let memoryState = {
            level: 1,
            numbers: '',
            userAnswer: '',
            correct: 0,
            maxLevel: 5
        };

        function initMemory() {
            memoryState = { level: 1, numbers: '', userAnswer: '', correct: 0, maxLevel: 5 };
            document.getElementById('memory-result').style.display = 'none';
            document.getElementById('memory-input').style.display = 'none';
            startMemoryRound();
        }

        function startMemoryRound() {
            const numCount = memoryState.level + 2;
            memoryState.numbers = '';
            for (let i = 0; i < numCount; i++) {
                memoryState.numbers += Math.floor(Math.random() * 10);
            }
            memoryState.userAnswer = '';
            
            document.getElementById('memory-display').textContent = 'ì¤€ë¹„...';
            document.getElementById('user-answer').textContent = '';
            document.getElementById('memory-input').style.display = 'none';
            
            setTimeout(() => {
                document.getElementById('memory-display').textContent = memoryState.numbers;
                
                setTimeout(() => {
                    document.getElementById('memory-display').textContent = '?';
                    document.getElementById('memory-input').style.display = 'flex';
                }, 1500 + memoryState.level * 500);
            }, 1000);
            
            updateMemoryUI();
        }

        function inputNumber(num) {
            memoryState.userAnswer += num;
            document.getElementById('user-answer').textContent = memoryState.userAnswer;
        }

        function clearAnswer() {
            memoryState.userAnswer = '';
            document.getElementById('user-answer').textContent = '';
        }

        function submitMemory() {
            if (memoryState.userAnswer === memoryState.numbers) {
                memoryState.correct++;
                document.getElementById('memory-display').textContent = 'ì •ë‹µ! ğŸ‘';
                document.getElementById('memory-display').classList.add('pulse');
            } else {
                document.getElementById('memory-display').textContent = `ì˜¤ë‹µ! ì •ë‹µ: ${memoryState.numbers}`;
            }
            
            memoryState.level++;
            
            setTimeout(() => {
                document.getElementById('memory-display').classList.remove('pulse');
                if (memoryState.level > memoryState.maxLevel) {
                    endMemory();
                } else {
                    startMemoryRound();
                }
            }, 1500);
        }

        function updateMemoryUI() {
            document.getElementById('memory-level').textContent = `${memoryState.level}/${memoryState.maxLevel}`;
            document.getElementById('memory-correct').textContent = memoryState.correct;
            document.getElementById('memory-progress').style.width = `${((memoryState.level - 1) / memoryState.maxLevel) * 100}%`;
        }

        function endMemory() {
            const score = memoryState.correct * 20;
            gameState.memory.score = score;
            gameState.memory.completed = true;
            gameState.totalScore += score;
            
            document.getElementById('memory-score').textContent = score;
            document.getElementById('memory-result').style.display = 'block';
            document.getElementById('memory-input').style.display = 'none';
        }

        // ============================================
        // 4. ì†ë‹´ ì™„ì„±í•˜ê¸°
        // ============================================
        const proverbs = [
            { text: 'ê°€ëŠ” ë§ì´ ê³ ì™€ì•¼ ____ ë§ì´ ê³±ë‹¤', answer: 'ì˜¤ëŠ”', options: ['ì˜¤ëŠ”', 'ê°€ëŠ”', 'ë¨¼', 'í°'] },
            { text: 'ë‚®ë§ì€ ìƒˆê°€ ë“£ê³  ____ ì¥ê°€ ë“£ëŠ”ë‹¤', answer: 'ë°¤ë§ì€', options: ['ë°¤ë§ì€', 'í°ë§ì€', 'ì‘ì€ë§ì€', 'ê¸´ë§ì€'] },
            { text: 'ì„¸ ì‚´ ë²„ë¦‡ ____ ê°„ë‹¤', answer: 'ì—¬ë“ ê¹Œì§€', options: ['ì—¬ë“ ê¹Œì§€', 'í‰ìƒ', 'ì–´ë¥¸ê¹Œì§€', 'ì£½ì„ë•Œê¹Œì§€'] },
            { text: 'ë›°ëŠ” ë†ˆ ìœ„ì— ____ ë†ˆ ìˆë‹¤', answer: 'ë‚˜ëŠ”', options: ['ë‚˜ëŠ”', 'ë›°ëŠ”', 'ê±·ëŠ”', 'ì„œëŠ”'] },
            { text: 'ë°±ì§€ì¥ë„ ____ ë‚«ë‹¤', answer: 'ë§ë“¤ë©´', options: ['ë§ë“¤ë©´', 'í˜¼ìë©´', 'ë‘˜ì´ë©´', 'ê°™ì´ë©´'] },
            { text: 'ì½© ì‹¬ì€ ë° ì½© ë‚˜ê³  ____ ì‹¬ì€ ë° íŒ¥ ë‚œë‹¤', answer: 'íŒ¥', options: ['íŒ¥', 'ì½©', 'ìŒ€', 'ë³´ë¦¬'] },
            { text: 'í˜¸ë‘ì´ë„ ____ í•˜ë©´ ì˜¨ë‹¤', answer: 'ì œ ë§', options: ['ì œ ë§', 'í° ì†Œë¦¬', 'ì´ë¦„', 'ìƒê°'] }
        ];

        let proverbState = {
            current: 0,
            correct: 0,
            shuffledProverbs: []
        };

        function initProverb() {
            proverbState = { current: 0, correct: 0, shuffledProverbs: [...proverbs].sort(() => Math.random() - 0.5).slice(0, 5) };
            document.getElementById('proverb-result').style.display = 'none';
            showProverb();
        }

        function showProverb() {
            const p = proverbState.shuffledProverbs[proverbState.current];
            document.getElementById('proverb-display').innerHTML = p.text.replace('____', '<span class="proverb-blank"></span>');
            
            const optionsDiv = document.getElementById('proverb-options');
            optionsDiv.innerHTML = '';
            
            const shuffledOptions = [...p.options].sort(() => Math.random() - 0.5);
            shuffledOptions.forEach(option => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = option;
                btn.onclick = () => checkProverb(option, btn);
                optionsDiv.appendChild(btn);
            });
            
            updateProverbUI();
        }

        function checkProverb(answer, btn) {
            const p = proverbState.shuffledProverbs[proverbState.current];
            const buttons = document.querySelectorAll('.option-btn');
            buttons.forEach(b => b.onclick = null);
            
            if (answer === p.answer) {
                btn.classList.add('correct');
                proverbState.correct++;
            } else {
                btn.classList.add('wrong');
                buttons.forEach(b => {
                    if (b.textContent === p.answer) b.classList.add('correct');
                });
            }
            
            proverbState.current++;
            
            setTimeout(() => {
                if (proverbState.current >= 5) {
                    endProverb();
                } else {
                    showProverb();
                }
            }, 1500);
        }

        function updateProverbUI() {
            document.getElementById('proverb-num').textContent = `${proverbState.current + 1}/5`;
            document.getElementById('proverb-correct').textContent = proverbState.correct;
            document.getElementById('proverb-progress').style.width = `${(proverbState.current / 5) * 100}%`;
        }

        function endProverb() {
            const score = proverbState.correct * 20;
            gameState.proverb.score = score;
            gameState.proverb.completed = true;
            gameState.totalScore += score;
            
            document.getElementById('proverb-score').textContent = score;
            document.getElementById('proverb-result').style.display = 'block';
        }

        // ============================================
        // 5. ì‚°ìˆ˜ ê³„ì‚°
        // ============================================
        let calcState = {
            current: 0,
            correct: 0,
            currentAnswer: 0,
            problems: []
        };

        function initCalc() {
            calcState = { current: 0, correct: 0, currentAnswer: 0, problems: [] };
            document.getElementById('calc-result').style.display = 'none';
            
            for (let i = 0; i < 5; i++) {
                const type = Math.random() > 0.5 ? '+' : '-';
                let a, b;
                
                if (type === '+') {
                    a = Math.floor(Math.random() * 50) + 10;
                    b = Math.floor(Math.random() * 40) + 5;
                } else {
                    a = Math.floor(Math.random() * 50) + 30;
                    b = Math.floor(Math.random() * 25) + 5;
                }
                
                calcState.problems.push({
                    text: `${a} ${type} ${b} = ?`,
                    answer: type === '+' ? a + b : a - b
                });
            }
            
            showCalcProblem();
        }

        function showCalcProblem() {
            const p = calcState.problems[calcState.current];
            document.getElementById('calc-problem').textContent = p.text;
            document.getElementById('calc-answer').value = '';
            calcState.currentAnswer = p.answer;
            updateCalcUI();
        }

        function submitCalc() {
            const userAnswer = parseInt(document.getElementById('calc-answer').value);
            
            if (userAnswer === calcState.currentAnswer) {
                calcState.correct++;
                document.getElementById('calc-problem').textContent = 'ì •ë‹µ! ğŸ‘';
            } else {
                document.getElementById('calc-problem').textContent = `ì˜¤ë‹µ! ì •ë‹µ: ${calcState.currentAnswer}`;
            }
            
            calcState.current++;
            
            setTimeout(() => {
                if (calcState.current >= 5) {
                    endCalc();
                } else {
                    showCalcProblem();
                }
            }, 1500);
        }

        function updateCalcUI() {
            document.getElementById('calc-num').textContent = `${calcState.current + 1}/5`;
            document.getElementById('calc-correct').textContent = calcState.correct;
            document.getElementById('calc-progress').style.width = `${(calcState.current / 5) * 100}%`;
        }

        function endCalc() {
            const score = calcState.correct * 20;
            gameState.calc.score = score;
            gameState.calc.completed = true;
            gameState.totalScore += score;
            
            document.getElementById('calc-score').textContent = score;
            document.getElementById('calc-result').style.display = 'block';
        }

        // ============================================
        // 6. ìˆœì„œ ë§ì¶”ê¸°
        // ============================================
        const sequenceQuestions = [
            { 
                items: ['ğŸ¥š', 'ğŸ£', 'ğŸ¥', 'ğŸ”'],
                instruction: 'ë‹¬ê±€ì—ì„œ ë‹­ì´ ë˜ëŠ” ìˆœì„œë¥¼ ë§ì¶°ë³´ì„¸ìš”!',
                answer: ['ğŸ¥š', 'ğŸ£', 'ğŸ¥', 'ğŸ”']
            },
            { 
                items: ['ğŸŒ±', 'ğŸŒ¿', 'ğŸŒ³', 'ğŸ‚'],
                instruction: 'ë‚˜ë¬´ê°€ ìë¼ëŠ” ìˆœì„œë¥¼ ë§ì¶°ë³´ì„¸ìš”!',
                answer: ['ğŸŒ±', 'ğŸŒ¿', 'ğŸŒ³', 'ğŸ‚']
            },
            { 
                items: ['ğŸŒ…', 'â˜€ï¸', 'ğŸŒ†', 'ğŸŒ™'],
                instruction: 'í•˜ë£¨ì˜ ìˆœì„œë¥¼ ë§ì¶°ë³´ì„¸ìš”!',
                answer: ['ğŸŒ…', 'â˜€ï¸', 'ğŸŒ†', 'ğŸŒ™']
            }
        ];

        let seqState = {
            current: 0,
            correct: 0,
            selected: [],
            currentQuestion: null
        };

        function initSequence() {
            seqState = { current: 0, correct: 0, selected: [], currentQuestion: null };
            document.getElementById('sequence-result').style.display = 'none';
            showSequenceQuestion();
        }

        function showSequenceQuestion() {
            seqState.currentQuestion = sequenceQuestions[seqState.current];
            seqState.selected = [];
            
            document.getElementById('seq-instruction').textContent = seqState.currentQuestion.instruction;
            
            const itemsDiv = document.getElementById('sequence-items');
            const selectedDiv = document.getElementById('selected-sequence');
            itemsDiv.innerHTML = '';
            selectedDiv.innerHTML = '';
            
            const shuffled = [...seqState.currentQuestion.items].sort(() => Math.random() - 0.5);
            
            shuffled.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'seq-item';
                div.textContent = item;
                div.dataset.item = item;
                div.onclick = () => selectSequenceItem(item, div);
                itemsDiv.appendChild(div);
            });
            
            updateSeqUI();
        }

        function selectSequenceItem(item, element) {
            if (seqState.selected.includes(item)) return;
            
            seqState.selected.push(item);
            element.classList.add('selected');
            
            const selectedDiv = document.getElementById('selected-sequence');
            const div = document.createElement('div');
            div.className = 'selected-item';
            div.textContent = item;
            selectedDiv.appendChild(div);
        }

        function resetSequence() {
            seqState.selected = [];
            document.getElementById('selected-sequence').innerHTML = '';
            document.querySelectorAll('.seq-item').forEach(item => item.classList.remove('selected'));
        }

        function submitSequence() {
            if (seqState.selected.length !== seqState.currentQuestion.answer.length) {
                showToast('ëª¨ë“  ê·¸ë¦¼ì„ ìˆœì„œëŒ€ë¡œ ì„ íƒí•´ì£¼ì„¸ìš”!', 'error');
                return;
            }
            
            const isCorrect = seqState.selected.every((item, index) => item === seqState.currentQuestion.answer[index]);
            
            if (isCorrect) {
                seqState.correct++;
                document.getElementById('seq-instruction').textContent = 'ì •ë‹µì…ë‹ˆë‹¤! ğŸ‘';
            } else {
                document.getElementById('seq-instruction').textContent = `ì˜¤ë‹µ! ì •ë‹µ: ${seqState.currentQuestion.answer.join(' â†’ ')}`;
            }
            
            seqState.current++;
            
            setTimeout(() => {
                if (seqState.current >= 3) {
                    endSequence();
                } else {
                    showSequenceQuestion();
                }
            }, 2000);
        }

        function updateSeqUI() {
            document.getElementById('seq-num').textContent = `${seqState.current + 1}/3`;
            document.getElementById('seq-correct').textContent = seqState.correct;
            document.getElementById('seq-progress').style.width = `${(seqState.current / 3) * 100}%`;
        }

        function endSequence() {
            const score = Math.round(seqState.correct * 33.33);
            gameState.sequence.score = score;
            gameState.sequence.completed = true;
            gameState.totalScore += score;
            
            document.getElementById('sequence-score').textContent = score;
            document.getElementById('sequence-result').style.display = 'block';
        }

        // ì—”í„°í‚¤ ì§€ì›
        document.getElementById('calc-answer').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') submitCalc();
        });

        document.getElementById('playerName').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') startGame();
        });

        // ì´ˆê¸°í™”
        updateScoreboard();
    </script>

    <!-- HeyGen Avatar PIP Widget -->
    <div id="heygen-pip-container">
      <iframe
        id="heygen-pip"
        src="https://dementia-prevent-game-bot-sbj.netlify.app/"    
        allow="camera; microphone; autoplay; clipboard-write"
      ></iframe>
      
      <!-- ë“œë˜ê·¸ ì˜ì—­ (í…Œë‘ë¦¬) -->
      <div class="pip-drag-border top"></div>
      <div class="pip-drag-border left"></div>
      <div class="pip-drag-border right"></div>
      <div class="pip-drag-border bottom"></div>
      
      <!-- í˜¸ë²„ ê·¸ë¼ë°ì´ì…˜ -->
      <div class="pip-hover-gradient"></div>
      
      <!-- ì»¨íŠ¸ë¡¤ ë²„íŠ¼ -->
      <div class="pip-controls">
        <button class="pip-ctrl-btn" onclick="toggleMinimizePIP()" title="ìµœì†Œí™”">âˆ’</button>
        <button class="pip-ctrl-btn close-btn" onclick="closePIP()" title="ë‹«ê¸°">Ã—</button>
      </div>
    </div>

    <button id="heygen-pip-toggle" onclick="showPIP()">ğŸ¤–</button>

    <!-- PIP ë“œë˜ê·¸ ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
    (function() {
      const container = document.getElementById('heygen-pip-container');
      const dragBorders = document.querySelectorAll('.pip-drag-border');
      
      if (!container || !dragBorders.length) return;
      
      let isDragging = false;
      let startX, startY, startLeft, startTop;
      
      dragBorders.forEach(border => {
        border.addEventListener('mousedown', startDrag);
        border.addEventListener('touchstart', startDrag, { passive: false });
      });
      
      function startDrag(e) {
        isDragging = true;
        container.classList.add('dragging');
        
        const touch = e.touches ? e.touches[0] : e;
        startX = touch.clientX;
        startY = touch.clientY;
        
        const rect = container.getBoundingClientRect();
        startLeft = rect.left;
        startTop = rect.top;
        
        e.preventDefault();
      }
      
      document.addEventListener('mousemove', drag);
      document.addEventListener('touchmove', drag, { passive: false });
      
      function drag(e) {
        if (!isDragging) return;
        
        const touch = e.touches ? e.touches[0] : e;
        const deltaX = touch.clientX - startX;
        const deltaY = touch.clientY - startY;
        
        let newLeft = startLeft + deltaX;
        let newTop = startTop + deltaY;
        
        const maxLeft = window.innerWidth - container.offsetWidth;
        const maxTop = window.innerHeight - container.offsetHeight;
        
        newLeft = Math.max(0, Math.min(newLeft, maxLeft));
        newTop = Math.max(0, Math.min(newTop, maxTop));
        
        container.style.left = newLeft + 'px';
        container.style.top = newTop + 'px';
        container.style.right = 'auto';
        container.style.bottom = 'auto';
        
        e.preventDefault();
      }
      
      document.addEventListener('mouseup', stopDrag);
      document.addEventListener('touchend', stopDrag);
      
      function stopDrag() {
        isDragging = false;
        container.classList.remove('dragging');
      }
    })();

    let isPIPMinimized = false;

    // ğŸ†• ìˆ˜ì •ëœ í•¨ìˆ˜
    function toggleMinimizePIP() {
      const container = document.getElementById('heygen-pip-container');
      const rect = container.getBoundingClientRect();
      
      const fullWidth = 380;
      const fullHeight = 214;
      const miniWidth = 120;
      const miniHeight = 68;
      
      if (!isPIPMinimized) {
        // ìµœì†Œí™”: ìš°ì¸¡ í•˜ë‹¨ ê³ ì •
        const rightEdge = rect.right;
        const bottomEdge = rect.bottom;
        
        container.style.left = (rightEdge - miniWidth) + 'px';
        container.style.top = (bottomEdge - miniHeight) + 'px';
        container.style.right = 'auto';
        container.style.bottom = 'auto';
        
        isPIPMinimized = true;
        container.classList.add('minimized');
      } else {
        // ë³µì›: ìš°ì¸¡ í•˜ë‹¨ ê³ ì •
        const rightEdge = rect.right;
        const bottomEdge = rect.bottom;
        
        let newLeft = rightEdge - fullWidth;
        let newTop = bottomEdge - fullHeight;
        
        // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ì§€ ì•Šê²Œ
        newLeft = Math.max(0, newLeft);
        newTop = Math.max(0, newTop);
        
        container.style.left = newLeft + 'px';
        container.style.top = newTop + 'px';
        container.style.right = 'auto';
        container.style.bottom = 'auto';
        
        // ğŸ†• inline width/height ì œê±° - CSS ê¸°ë³¸ê°’ ì‚¬ìš©
        container.style.width = '';
        container.style.height = '';
        
        isPIPMinimized = false;
        container.classList.remove('minimized');
      }
    }

    function closePIP() {
      document.getElementById('heygen-pip-container').classList.add('hidden');
    }

    function showPIP() {
      const container = document.getElementById('heygen-pip-container');
      container.classList.remove('hidden');
      if (isPIPMinimized) {
        isPIPMinimized = false;
        container.classList.remove('minimized');
      }
    }

    function toggleHeyGenPIP() {
      const container = document.getElementById('heygen-pip-container');
      container.classList.contains('hidden') ? showPIP() : closePIP();
    }
    </script>
</body>
</html>
